--echo #
--echo # Start of 11.5 tests
--echo #

--echo #
--echo # MDEV-31340 Remove MY_COLLATION_HANDLER::strcasecmp()
--echo #

#
# Identifiers are accent sensitive and case insensitive,
# and there are usually only two variants of a letter (capital and small)
# having equal octet length in utf8.
#
# There are a few exceptions (coming from Unicode casefolding rules)
# changing octet length during casefolding.
#
# Testing "U+0132 LATIN SMALL LETTER DOTLESS I" versus letters I and i.
#


# Column
SET NAMES utf8;
--error ER_DUP_FIELDNAME
CREATE TABLE t1 (I int, Ä± int);


# Index
--error ER_DUP_KEYNAME
CREATE TABLE t1 (a int, b int, KEY I(a), KEY Ä±(b));


# Locale
SET @@lc_time_names=it_Ä±T;
SELECT @@lc_time_names;
SET @@lc_time_names=DEFAULT;


# Host
#CREATE user u1@Ä±T;
#SELECT user, host FROM mysql.user WHERE user='u1';
#DROP USER u1@it;


# I_S table name
CREATE VIEW v1 AS SELECT 1;
SELECT COUNT(*) FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME='v1';
SELECT COUNT(*) FROM INFORMATION_SCHEMA.VÄ±EWS WHERE TABLE_NAME='v1';
DROP VIEW v1;


# Window name
CREATE OR REPLACE TABLE t1 (pk int, c int);
INSERT INTO t1 VALUES (1,1);
INSERT INTO t1 VALUES (1,2);
INSERT INTO t1 VALUES (1,3);
INSERT INTO t1 VALUES (2,1);
INSERT INTO t1 VALUES (2,2);
INSERT INTO t1 VALUES (2,3);
SELECT pk, COUNT(*) OVER I AS cnt
FROM t1
WINDOW Ä± AS (PARTITION BY c ORDER BY pk ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING);
DROP TABLE t1;


# Function
SELECT CEIL(10.6);
SELECT CEÄ±L(10.6);

CREATE FUNCTION I() RETURNS INT RETURN 1;
SELECT Ä±();
DROP FUNCTION Ä±;


# CTE - WITH reference
WITH I AS (SELECT 'a1' AS a, 'b1' AS b) SELECT * FROM Ä±;


# Plugin
--error ER_PLUGIN_INSTALLED
INSTALL PLUGIN arÄ±a SONAME 'not important';


# Engine
CREATE TABLE t1 (a INT) ENGINE=MyÄ±SAM;
SHOW CREATE TABLE t1;
DROP TABLE t1;


# System variable
SELECT @@CHARACTER_SET_CLÄ±ENT;


# User variable
SET @I='i';
SELECT @Ä±;


# System versioning: row start, row end

CREATE TABLE t1(
   x INT,
   start_timestamp TIMESTAMP(6) GENERATED ALWAYS AS ROW START,
   end_timestamp TIMESTAMP(6) GENERATED ALWAYS AS ROW END,
   PERIOD FOR SYSTEM_TIME(start_tÄ±mestamp, end_tÄ±mestamp)
) WITH SYSTEM VERSIONING;
SHOW CREATE TABLE t1;
DROP TABLE t1;


# Label names

DELIMITER $$;
--error ER_SP_LABEL_REDEFINE
BEGIN NOT ATOMIC
label_Ä±:
   LOOP
label_I:
     LOOP
       LEAVE label_I;
     END LOOP;
     LEAVE label_Ä±;
   END LOOP;
END;
$$
DELIMITER ;$$

DELIMITER $$;
BEGIN NOT ATOMIC
   label_Ä±:
   LOOP
      SELECT 'looping' AS stage;
      LEAVE label_I;
   END LOOP;
   SELECT 'out of loop' AS stage;
END;
$$
DELIMITER ;$$


# References in GROUP BY

CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (1),(2),(3);
SELECT 'a' AS I FROM t1 GROUP BY Ä±;
SELECT 'a' AS Ä± FROM t1 GROUP BY I;
--error ER_BAD_FIELD_ERROR
SELECT 'a' AS Ä° FROM t1 GROUP BY i;
--error ER_BAD_FIELD_ERROR
SELECT 'a' AS i FROM t1 GROUP BY Ä°;
DROP TABLE t1;

--echo #
--echo # End of 11.5 tests
--echo #

--echo #
--echo # Start of 11.7 tests
--echo #

--echo #
--echo # MDEV-27490 Allow full utf8mb4 for identifiers
--echo #

SET NAMES utf8mb4;
CREATE DATABASE ðŸ˜Ž;
SELECT * FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME='ðŸ˜Ž';
SHOW DATABASES LIKE 'ðŸ˜Ž';
CREATE TABLE ðŸ˜Ž.ðŸ˜Ž (a INT);
SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME='ðŸ˜Ž';
SHOW TABLES IN ðŸ˜Ž;
SELECT TABLE_NAME, COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='ðŸ˜Ž';
SHOW COLUMNS IN ðŸ˜Ž.ðŸ˜Ž;
DROP TABLE ðŸ˜Ž.ðŸ˜Ž;
DROP DATABASE ðŸ˜Ž;

# Let DROP DATABASE drop the table with an utf8mb4 name
CREATE DATABASE ðŸ˜Ž;
CREATE TABLE ðŸ˜Ž.ðŸ˜Ž (a INT);
DROP DATABASE ðŸ˜Ž;


CREATE DATABASE ðŸ˜Ž;
CREATE FUNCTION ðŸ˜Ž.ðŸ˜Ž(ðŸ˜Ž INT) RETURNS INT RETURN 1;
SELECT ROUTINE_SCHEMA, ROUTINE_NAME FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_NAME='ðŸ˜Ž';
SELECT SPECIFIC_SCHEMA, SPECIFIC_NAME, PARAMETER_NAME FROM INFORMATION_SCHEMA.PARAMETERS WHERE SPECIFIC_SCHEMA='ðŸ˜Ž';
SHOW CREATE FUNCTION ðŸ˜Ž.ðŸ˜Ž;
SELECT ðŸ˜Ž.ðŸ˜Ž(1);
DROP FUNCTION ðŸ˜Ž.ðŸ˜Ž;
DROP DATABASE ðŸ˜Ž;

CREATE DATABASE ðŸ˜Ž;
CREATE FUNCTION ðŸ˜Ž.ðŸ˜Ž(ðŸ˜Ž INT) RETURNS INT RETURN 1;
DROP DATABASE ðŸ˜Ž;


CREATE DATABASE ðŸ˜Ž;
DELIMITER $$;
CREATE PROCEDURE ðŸ˜Ž.ðŸ˜Ž(ðŸ˜Ž INT)
BEGIN
  SELECT 'ðŸ˜Ž';
END
$$
DELIMITER ;$$
SELECT ROUTINE_SCHEMA, ROUTINE_NAME FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_NAME='ðŸ˜Ž';
SELECT SPECIFIC_SCHEMA, SPECIFIC_NAME, PARAMETER_NAME FROM INFORMATION_SCHEMA.PARAMETERS WHERE SPECIFIC_SCHEMA='ðŸ˜Ž';
SHOW CREATE PROCEDURE ðŸ˜Ž.ðŸ˜Ž;
CALL ðŸ˜Ž.ðŸ˜Ž(1);
DROP PROCEDURE ðŸ˜Ž.ðŸ˜Ž;
DROP DATABASE ðŸ˜Ž;

CREATE DATABASE ðŸ˜Ž;
DELIMITER $$;
CREATE PROCEDURE ðŸ˜Ž.ðŸ˜Ž(ðŸ˜Ž INT)
BEGIN
  SELECT 'ðŸ˜Ž';
END
$$
DELIMITER ;$$
DROP DATABASE ðŸ˜Ž;


--echo #
--echo # End of 11.7 tests
--echo #
